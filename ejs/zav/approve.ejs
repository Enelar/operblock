<div class="form-group" >
  <label>Хирург</label>
  <%= this.DeferRender('people/staff', 'staff/FilterByJob?filter=hivrach') %>
</div>

<div class="form-group" >
  <label>Трансфузолог</label>
  <%= this.DeferRender('people/staff', 'staff/FilterByJob?filter=dracula') %>
</div>

<div class="form-group" >
  <label>Ассистентка</label>
  <input type='text' name='assist' class='form-control'/>
</div>

<div class="form-group" >
  <label>Дежурный оперблока</label>
  <input type='text' name='dejob' class='form-control'/>
</div>

<button role='submit' class='btn btn-default'>Подтвердить</button>

<%
this.DeferCascade(function()
{
  this.first().find('input').attr('name', 'levrach');
  this.first().next().find('input').attr('name', 'dracula');
  this
    .first()
    .siblings("button[role='submit']")
    .click(function()
    {
      var parent = __context.first().parent();
      var people =
      [
        ['hivrach', parent.find('input[name="levrach"]').val()],
        ['dracula', parent.find('input[name="dracula"]').val()],
        ['assist',  parent.find('input[name="assist"]').val()],
        ['dejob', parent.find('input[name="dejob"]').val()],
      ];
      var id = __context.first().parents('.modal').find('[data-mark="id"]').html()
      Approve(id, people, function(data)
      {
        phoxy.ApiAnswer({'reset': true});
      });
    });
});
%>
